---
title: "InSeason_Projections_TE"
author: "Jack DePree"
date: "2024-01-11"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Within Season Projections for Tight Ends

## Contextualization
Each week adds more data that can be used to predict the future; it is assumed that the more data we have, then the more accurate our predictions will be. The data will be centered around discovering three aspects: "individual ability" (stable metrics of performance and efficiency), "situation" (a combination of both opportunity and opposition), "noise reduction" (unstable metrics of luck and unfortune).  Some variables will be unstable and others will be stable. Is there a point where a small sample of data is able to predict the future# If not, then does that mean there is a way we can leverage the unpredictability to outsmart other bettors?

## Reasoning
Using unstable variables as confounding variables, we can adjust the stable variables for more predictive validity. There should also be a point within a season where the amount of usable data passes the threshold of profitability, meaning that we finally have enough data to accurately predict the future: maybe two or three weeks. Furthermore, using the most recent weeks can be more useful than using the entire season to-date, meaning we can add weights to the most recent weeks' data to better predict the future. 

## Scientiic Questions
1. Which variables are highly associated with fantasy points? (Association)
2. Are there variables that are stable (from week to week, or for the next series of weeks) for Tight Ends? (Association)
3. Are there variables that are unstable (from week to week, or for the next series of weeks) for Tight Ends? (Association)
4. Can we make composites of variables to better synthesize the data for prediction, like "individual ability," "situation," "noise reduction?" (PCA)
5. Can we select specific past data (from the past 2, 3, 4 weeks) to better synthesize the data for prediction? (Prediction)

## Methodology
1. Create a df where each week is stacked upon one another for an association test. Compare each variable with both the player's given week's points and the player's total seasonal points.
2. Create a df with each week alongside each other week, for a week-to-week association test. Create summary statistics of each variable, sort by lowest variability. Create correlations between each variable of their past and future samples, sort by highest correlation. 
3. Create a df with each week alongside each other week, for a week-to-week association test. Create summary statistics of each variable, sort by highest variability. Create correlations between each variable of their past and future samples, sort by lowest correlation.
4. Use cluster analysis and model making to form composites of the previously selected variables.
5. Create multiple dfs where the past and future weeks have been averaged in varied ways using weights and recency bias to assess the most predictable weeks and their arrangements.

# Data Collection
```{r echo=FALSE}
library(dplyr)
library(tidyverse)
library(lsr)
library(corrplot)
library(MASSExtra)

setwd("C:/Users/Jack/Documents/GitHub/FFInsights/data")

wk1_23 <- read.csv("2023_wk1_flex_stats.csv")
wk2_23 <- read.csv("2023_wk2_flex_stats.csv")
wk3_23 <- read.csv("2023_wk3_flex_stats.csv")
wk4_23 <- read.csv("2023_wk4_flex_stats.csv")
wk5_23 <- read.csv("2023_wk5_flex_stats.csv")
wk6_23 <- read.csv("2023_wk6_flex_stats.csv")
wk7_23 <- read.csv("2023_wk7_flex_stats.csv")
wk8_23 <- read.csv("2023_wk8_flex_stats.csv")
wk9_23 <- read.csv("2023_wk9_flex_stats.csv")
wk10_23 <- read.csv("2023_wk10_flex_stats.csv")
wk11_23 <- read.csv("2023_wk11_flex_stats.csv")
wk12_23 <- read.csv("2023_wk12_flex_stats.csv")
wk13_23 <- read.csv("2023_wk13_flex_stats.csv")
wk14_23 <- read.csv("2023_wk14_flex_stats.csv")
wk15_23 <- read.csv("2023_wk15_flex_stats.csv")
wk16_23 <- read.csv("2023_wk16_flex_stats.csv")
wk17_23 <- read.csv("2023_wk17_flex_stats.csv")
total_23 <- read.csv("2023_total_flex_stats.csv")

wk1_22 <- read.csv("2022_wk1_flex_stats.csv")
wk2_22 <- read.csv("2022_wk2_flex_stats.csv")
wk3_22 <- read.csv("2022_wk3_flex_stats.csv")
wk4_22 <- read.csv("2022_wk4_flex_stats.csv")
wk5_22 <- read.csv("2022_wk5_flex_stats.csv")
wk6_22 <- read.csv("2022_wk6_flex_stats.csv")
wk7_22 <- read.csv("2022_wk7_flex_stats.csv")
wk8_22 <- read.csv("2022_wk8_flex_stats.csv")
wk9_22 <- read.csv("2022_wk9_flex_stats.csv")
wk10_22 <- read.csv("2022_wk10_flex_stats.csv")
wk11_22 <- read.csv("2022_wk11_flex_stats.csv")
wk12_22 <- read.csv("2022_wk12_flex_stats.csv")
wk13_22 <- read.csv("2022_wk13_flex_stats.csv")
wk14_22 <- read.csv("2022_wk14_flex_stats.csv")
wk15_22 <- read.csv("2022_wk15_flex_stats.csv")
wk16_22 <- read.csv("2022_wk16_flex_stats.csv")
wk17_22 <- read.csv("2022_wk17_flex_stats.csv")
total_22 <- read.csv("2022_total_flex_stats.csv")

wk1_21 <- read.csv("2021_wk1_flex_stats.csv")
wk2_21 <- read.csv("2021_wk2_flex_stats.csv")
wk3_21 <- read.csv("2021_wk3_flex_stats.csv")
wk4_21 <- read.csv("2021_wk4_flex_stats.csv")
wk5_21 <- read.csv("2021_wk5_flex_stats.csv")
wk6_21 <- read.csv("2021_wk6_flex_stats.csv")
wk7_21 <- read.csv("2021_wk7_flex_stats.csv")
wk8_21 <- read.csv("2021_wk8_flex_stats.csv")
wk9_21 <- read.csv("2021_wk9_flex_stats.csv")
wk10_21 <- read.csv("2021_wk10_flex_stats.csv")
wk11_21 <- read.csv("2021_wk11_flex_stats.csv")
wk12_21 <- read.csv("2021_wk12_flex_stats.csv")
wk13_21 <- read.csv("2021_wk13_flex_stats.csv")
wk14_21 <- read.csv("2021_wk14_flex_stats.csv")
wk15_21 <- read.csv("2021_wk15_flex_stats.csv")
wk16_21 <- read.csv("2021_wk16_flex_stats.csv")
wk17_21 <- read.csv("2021_wk17_flex_stats.csv")
total_21 <- read.csv("2021_total_flex_stats.csv")

glimpse(total_22)
```

# Data Cleaning
```{r echo=FALSE}
wk1_23 <- wk1_23 %>% filter(position=="TE") %>% select(-c(team, games, position)) #filter out non-TEs and remove variables "team", "games", "position"
wk2_23 <- wk2_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk3_23 <- wk3_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk4_23 <- wk4_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk5_23 <- wk5_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk6_23 <- wk6_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk7_23 <- wk7_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk8_23 <- wk8_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk9_23 <- wk9_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk10_23 <- wk10_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk11_23 <- wk11_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk12_23 <- wk12_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk13_23 <- wk13_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk14_23 <- wk14_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk15_23 <- wk15_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk16_23 <- wk16_23 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk17_23 <- wk17_23 %>% filter(position=="TE") %>% select(-c(team, games, position))

wk1_22 <- wk1_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk2_22 <- wk2_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk3_22 <- wk3_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk4_22 <- wk4_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk5_22 <- wk5_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk6_22 <- wk6_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk7_22 <- wk7_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk8_22 <- wk8_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk9_22 <- wk9_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk10_22 <- wk10_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk11_22 <- wk11_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk12_22 <- wk12_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk13_22 <- wk13_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk14_22 <- wk14_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk15_22 <- wk15_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk16_22 <- wk16_22 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk17_22 <- wk17_22 %>% filter(position=="TE") %>% select(-c(team, games, position))

wk1_21 <- wk1_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk2_21 <- wk2_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk3_21 <- wk3_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk4_21 <- wk4_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk5_21 <- wk5_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk6_21 <- wk6_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk7_21 <- wk7_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk8_21 <- wk8_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk9_21 <- wk9_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk10_21 <- wk10_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk11_21 <- wk11_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk12_21 <- wk12_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk13_21 <- wk13_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk14_21 <- wk14_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk15_21 <- wk15_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk16_21 <- wk16_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
wk17_21 <- wk17_21 %>% filter(position=="TE") %>% select(-c(team, games, position))
```

# Data Transformation
```{r echo=FALSE}
total_23 <- select(total_23, c(player, fantasyPts)) #selecting the total fantasy points for each player in a given year
total_22 <- select(total_22, c(player, fantasyPts))
total_21 <- select(total_21, c(player, fantasyPts))
```

```{r echo=FALSE}
big_23 <- rbind(wk1_23,wk2_23,wk3_23,wk4_23,wk5_23,wk6_23,wk7_23,wk8_23,wk9_23,wk10_23,wk11_23,wk12_23,wk13_23,wk14_23,wk15_23,wk16_23,wk17_23) #combining all weeks on a vertical basis
big_23 <- merge(big_23, total_23, by="player", all=T, suffixes=c(".x", ".y")) #merging the combined weeks and each player's respective total fantasy points for the year

big_22 <- rbind(wk1_22,wk2_22,wk3_22,wk4_22,wk5_22,wk6_22,wk7_22,wk8_22,wk9_22,wk10_22,wk11_22,wk12_22,wk13_22,wk14_22,wk15_22,wk16_22,wk17_22)
big_22 <- merge(big_22, total_22, by="player", all=T, suffixes=c(".x", ".y"))

big_21 <- rbind(wk1_21,wk2_21,wk3_21,wk4_21,wk5_21,wk6_21,wk7_21,wk8_21,wk9_21,wk10_21,wk11_21,wk12_21,wk13_21,wk14_21,wk15_21,wk16_21,wk17_21)
big_21 <- merge(big_21, total_21, by="player", all=T, suffixes=c(".x", ".y"))
```

```{r echo=FALSE}
big_association <- rbind(big_23, big_22, big_21) %>% 
  select(-c(player)) %>%
  na.omit()
big_association <- subset(big_association, recTarg>0)
glimpse(big_association)
```

Pairing adjacent weeks and respective players' stats are averaged
```{r echo=FALSE}
weeks_pair1_23 <- rbind(wk1_23, wk2_23) %>%           #binds the two dfs vertically into one df
  group_by(player) %>%                                #groups by player so that we can later average each player's performance
  filter(n() == 2) %>%                                #filters out players who only appear once, meaning that they only played one game
  summarise(across(.fns=mean))                        #summarises the data across each row to find the averages for each player
weeks_pair2_23 <- rbind(wk2_23, wk3_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair3_23 <- rbind(wk3_23, wk4_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair4_23 <- rbind(wk4_23, wk5_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair5_23 <- rbind(wk5_23, wk6_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair6_23 <- rbind(wk6_23, wk7_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair7_23 <- rbind(wk7_23, wk8_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair8_23 <- rbind(wk8_23, wk9_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair9_23 <- rbind(wk9_23, wk10_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair10_23 <- rbind(wk10_23, wk11_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair11_23 <- rbind(wk11_23, wk12_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair12_23 <- rbind(wk12_23, wk13_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair13_23 <- rbind(wk13_23, wk14_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair14_23 <- rbind(wk14_23, wk15_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair15_23 <- rbind(wk15_23, wk16_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair16_23 <- rbind(wk16_23, wk17_23) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))

weeks_pair1_22 <- rbind(wk1_22, wk2_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair2_22 <- rbind(wk2_22, wk3_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair3_22 <- rbind(wk3_22, wk4_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair4_22 <- rbind(wk4_22, wk5_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair5_22 <- rbind(wk5_22, wk6_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair6_22 <- rbind(wk6_22, wk7_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair7_22 <- rbind(wk7_22, wk8_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair8_22 <- rbind(wk8_22, wk9_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair9_22 <- rbind(wk9_22, wk10_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair10_22 <- rbind(wk10_22, wk11_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair11_22 <- rbind(wk11_22, wk12_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair12_22 <- rbind(wk12_22, wk13_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair13_22 <- rbind(wk13_22, wk14_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair14_22 <- rbind(wk14_22, wk15_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair15_22 <- rbind(wk15_22, wk16_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair16_22 <- rbind(wk16_22, wk17_22) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))

weeks_pair1_21 <- rbind(wk1_21, wk2_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair2_21 <- rbind(wk2_21, wk3_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair3_21 <- rbind(wk3_21, wk4_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair4_21 <- rbind(wk4_21, wk5_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair5_21 <- rbind(wk5_21, wk6_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair6_21 <- rbind(wk6_21, wk7_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair7_21 <- rbind(wk7_21, wk8_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair8_21 <- rbind(wk8_21, wk9_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair9_21 <- rbind(wk9_21, wk10_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair10_21 <- rbind(wk10_21, wk11_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair11_21 <- rbind(wk11_21, wk12_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair12_21 <- rbind(wk12_21, wk13_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair13_21 <- rbind(wk13_21, wk14_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair14_21 <- rbind(wk14_21, wk15_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair15_21 <- rbind(wk15_21, wk16_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
weeks_pair16_21 <- rbind(wk16_21, wk17_21) %>%
  group_by(player) %>%
  filter(n() == 2) %>%
  summarise(across(.fns=mean))
```

```{r echo=FALSE}
pairs_23 <- rbind(weeks_pair1_23, weeks_pair2_23, weeks_pair3_23, weeks_pair4_23, weeks_pair5_23, weeks_pair6_23, weeks_pair7_23, weeks_pair8_23,
                  weeks_pair9_23, weeks_pair10_23, weeks_pair11_23, weeks_pair12_23, weeks_pair13_23, weeks_pair14_23, weeks_pair15_23,
                  weeks_pair16_23)
pairs_23 <- merge(pairs_23, total_23, by="player", all=T, suffixes=c(".x", ".y"))

pairs_22 <- rbind(weeks_pair1_22, weeks_pair2_22, weeks_pair3_22, weeks_pair4_22, weeks_pair5_22, weeks_pair6_22, weeks_pair7_22, weeks_pair8_22,
                  weeks_pair9_22, weeks_pair10_22, weeks_pair11_22, weeks_pair12_22, weeks_pair13_22, weeks_pair14_22, weeks_pair15_22,
                  weeks_pair16_22)
pairs_22 <- merge(pairs_22, total_22, by="player", all=T, suffixes=c(".x", ".y"))

pairs_21 <- rbind(weeks_pair1_21, weeks_pair2_21, weeks_pair3_21, weeks_pair4_21, weeks_pair5_21, weeks_pair6_21, weeks_pair7_21, weeks_pair8_21,
                  weeks_pair9_21, weeks_pair10_21, weeks_pair11_21, weeks_pair12_21, weeks_pair13_21, weeks_pair14_21, weeks_pair15_21,
                  weeks_pair16_21)
pairs_21 <- merge(pairs_21, total_21, by="player", all=T, suffixes=c(".x", ".y"))
```

```{r echo=FALSE}
big_pairs <- rbind(pairs_23, pairs_22, pairs_21) %>% 
  select(-c(player)) %>%
  na.omit() %>%
  round(2)
glimpse(big_pairs)
```

```{r echo=FALSE}
weeks_trio1_23 <- rbind(wk1_23, wk2_23, wk3_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio2_23 <- rbind(wk2_23, wk3_23, wk4_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio3_23 <- rbind(wk3_23, wk4_23, wk5_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio4_23 <- rbind(wk4_23, wk5_23, wk6_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio5_23 <- rbind(wk5_23, wk6_23, wk7_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio6_23 <- rbind(wk6_23, wk7_23, wk8_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio7_23 <- rbind(wk7_23, wk8_23, wk9_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio8_23 <- rbind(wk8_23, wk9_23, wk10_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio9_23 <- rbind(wk9_23, wk10_23, wk11_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio10_23 <- rbind(wk10_23, wk11_23, wk12_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio11_23 <- rbind(wk11_23, wk12_23, wk13_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio12_23 <- rbind(wk12_23, wk13_23, wk14_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio13_23 <- rbind(wk13_23, wk14_23, wk15_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio14_23 <- rbind(wk14_23, wk15_23, wk16_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio15_23 <- rbind(wk15_23, wk16_23, wk17_23) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))

weeks_trio1_22 <- rbind(wk1_22, wk2_22, wk3_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio2_22 <- rbind(wk2_22, wk3_22, wk4_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio3_22 <- rbind(wk3_22, wk4_22, wk5_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio4_22 <- rbind(wk4_22, wk5_22, wk6_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio5_22 <- rbind(wk5_22, wk6_22, wk7_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio6_22 <- rbind(wk6_22, wk7_22, wk8_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio7_22 <- rbind(wk7_22, wk8_22, wk9_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio8_22 <- rbind(wk8_22, wk9_22, wk10_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio9_22 <- rbind(wk9_22, wk10_22, wk11_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio10_22 <- rbind(wk10_22, wk11_22, wk12_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio11_22 <- rbind(wk11_22, wk12_22, wk13_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio12_22 <- rbind(wk12_22, wk13_22, wk14_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio13_22 <- rbind(wk13_22, wk14_22, wk15_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio14_22 <- rbind(wk14_22, wk15_22, wk16_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio15_22 <- rbind(wk15_22, wk16_22, wk17_22) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))

weeks_trio1_21 <- rbind(wk1_21, wk2_21, wk3_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio2_21 <- rbind(wk2_21, wk3_21, wk4_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio3_21 <- rbind(wk3_21, wk4_21, wk5_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio4_21 <- rbind(wk4_21, wk5_21, wk6_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio5_21 <- rbind(wk5_21, wk6_21, wk7_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio6_21 <- rbind(wk6_21, wk7_21, wk8_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio7_21 <- rbind(wk7_21, wk8_21, wk9_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio8_21 <- rbind(wk8_21, wk9_21, wk10_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio9_21 <- rbind(wk9_21, wk10_21, wk11_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio10_21 <- rbind(wk10_21, wk11_21, wk12_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio11_21 <- rbind(wk11_21, wk12_21, wk13_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio12_21 <- rbind(wk12_21, wk13_21, wk14_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio13_21 <- rbind(wk13_21, wk14_21, wk15_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio14_21 <- rbind(wk14_21, wk15_21, wk16_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
weeks_trio15_21 <- rbind(wk15_21, wk16_21, wk17_21) %>%
  group_by(player) %>%
  filter(n() == 3) %>%
  summarise(across(.fns=mean))
```

```{r echo=FALSE}
trios_23 <- rbind(weeks_trio1_23,weeks_trio2_23,weeks_trio3_23,weeks_trio4_23,weeks_trio5_23,weeks_trio6_23,weeks_trio7_23,weeks_trio8_23,weeks_trio9_23,weeks_trio10_23,
                  weeks_trio11_23,weeks_trio12_23,weeks_trio13_23,weeks_trio14_23,weeks_trio15_23)
trios_23 <- merge(trios_23, total_23, by="player", all=T, suffixes=c(".x", ".y"))

trios_22 <- rbind(weeks_trio1_22,weeks_trio2_22,weeks_trio3_22,weeks_trio4_22,weeks_trio5_22,weeks_trio6_22,weeks_trio7_22,weeks_trio8_22,weeks_trio9_22,weeks_trio10_22,
                  weeks_trio11_22,weeks_trio12_22,weeks_trio13_22,weeks_trio14_22,weeks_trio15_22)
trios_22 <- merge(trios_22, total_22, by="player", all=T, suffixes=c(".x", ".y"))

trios_21 <- rbind(weeks_trio1_21,weeks_trio2_21,weeks_trio3_21,weeks_trio4_21,weeks_trio5_21,weeks_trio6_21,weeks_trio7_21,weeks_trio8_21,weeks_trio9_21,weeks_trio10_21,
                  weeks_trio11_21,weeks_trio12_21,weeks_trio13_21,weeks_trio14_21,weeks_trio15_21)
trios_21 <- merge(trios_21, total_21, by="player", all=T, suffixes=c(".x", ".y"))
```

```{r echo=FALSE}
big_trios <- rbind(trios_23, trios_22, trios_21) %>% 
  select(-c(player)) %>%
  na.omit() %>%
  round(2)
glimpse(big_trios)
```

```{r echo=FALSE}
half_23 <- rbind(wk1_23,wk2_23,wk3_23,wk4_23,wk5_23,wk6_23,wk7_23,wk8_23,wk9_23) %>%
  group_by(player) %>%
  filter(n() >= 5) %>%
  summarise(across(.fns=mean))
half_23 <- merge(half_23, total_23, by="player", all=T, suffixes=c(".x", ".y")) 

half_22 <- rbind(wk1_22,wk2_22,wk3_22,wk4_22,wk5_22,wk6_22,wk7_22,wk8_22,wk9_22) %>%
  group_by(player) %>%
  filter(n() >= 5) %>%
  summarise(across(.fns=mean))
half_22 <- merge(half_22, total_22, by="player", all=T, suffixes=c(".x", ".y"))

half_21 <- rbind(wk1_21,wk2_21,wk3_21,wk4_21,wk5_21,wk6_21,wk7_21,wk8_21,wk9_21) %>%
  group_by(player) %>%
  filter(n() >= 5) %>%
  summarise(across(.fns=mean))
half_21 <- merge(half_21, total_21, by="player", all=T, suffixes=c(".x", ".y"))
```

```{r echo=FALSE}
big_half <- rbind(half_23, half_22, half_21) %>% 
  select(-c(player)) %>%
  na.omit() %>%
  round(2)
glimpse(big_half)
```

# Data Analysis

```{r echo=FALSE}
cv <- function(x) {           # Coefficient of Variation, a relative measure of variation dependent upon a variable's average
  m <- mean(x)
  sd <- sd(x)
  cv <- sd/m
  return(cv)
}
```

```{r echo=FALSE}
colnames <- c(colnames(big_association))
cor.x <- c(round(cor(big_association, big_association$fantasyPts.x, use="complete.obs"), 3))  #making a vector of correlations between a given variable and the given week's points
cor.y <- c(round(cor(big_association, big_association$fantasyPts.y, use="complete.obs"), 3))  #making a vector of correlations between a given variable and the given year's points
varco <- c(round(apply(big_association, 2, cv), 3)) #coef of variation for each variable
comatrix <- data.frame(colnames=colnames, cor.x=cor.x, cor.y=cor.y, varco=varco)
arrange(comatrix, desc(cor.y))
```

```{r echo=FALSE}
pca <- prcomp(big_association)
#predict(pca) %*% t(pca$rotation) + colMeans(big_association)
#sort(abs(pca$rotation[,1]), decreasing=T)
#summary(pca)
loadings <- arrange(round(data.frame(pca$rotation)[1:4], 4), desc(PC1))
loadings
```

```{r echo=FALSE}
data <- big_association %>% 
  select(c(recRec, recYds, recTds, fantasyPts.x)) %>% 
  na.omit() #creating a dataset to make a model
all <- lm(fantasyPts.x ~ ., data=data)  #making a model with every variable in the given dataset
model <- step(all, direction = "backward", trace=0) #using a backwards stepwise process to simplify the model
summary(model)
```

```{r echo=FALSE}
data <- big_association %>% 
  select(-c(recRec, recYds, recTds, fantasyPts.y)) %>% 
  na.omit()
all <- lm(fantasyPts.x ~ ., data=data)
model <- step(all, direction = "backward", trace=0)
summary(model)
```

```{r echo=FALSE}
data <- big_association %>% 
  select(-c(recRec, recYds, recTds, recRec40s, recYds100Games, recTd40s, rzRecRec, rzRecTds, ezRecTds, rushYds, rushTds, fantasyPts.y)) %>% 
  na.omit()
all <- lm(fantasyPts.x ~ ., data=data)
model <- step(all, direction = "backward", trace=0)
summary(model)
```

```{r echo=FALSE}
data <- big_association %>% 
  select(c(recTarg, catch, rzRecTarg, rzRecTdPct, ptsPerTouch, fantasyPts.x)) %>% 
  na.omit()
all <- lm(fantasyPts.x ~ ., data=data)
model <- step(all, direction = "backward", trace=0)
summary(model)
```

# Data Visualization

```{r echo=FALSE}
data <- big_association %>%
  select(c(recTarg, catch, rzRecTarg, rzRecTdPct, ptsPerTouch, fantasyPts.x))
plot <- cor(data)
corrplot(plot, method = 'color', order = 'AOE', diag = FALSE) #creating a correlogram 
```

```{r echo=FALSE}
ggplot(subset(big_association, recTds<3), aes(x=factor(recTds), y=fantasyPts.x)) +
  geom_violin(fill="darkorchid4") +
  labs(title="Receiving Tds and Fantasy Points (TE)", x="Receiving Touchdowns within game", y="Fantasy Points within game")

ggplot(big_association, aes(x=catch, y=fantasyPts.x)) +
  geom_smooth(data=subset(big_association, recTarg>1), method="loess", se=F, color="violet", linewidth=1.25) +
  geom_smooth(data=subset(big_association, recTarg>3), method="loess", se=F, color="darkorchid2", linewidth=1.25) +
  geom_smooth(data=subset(big_association, recTarg>5), method="loess", se=F, color="darkorchid3", linewidth=1.25) +
  geom_smooth(data=subset(big_association, recTarg>7), method="loess", se=F, color="darkorchid4", linewidth=1.25) +
  labs(title="Catch Percentage and Fantasy Points (TE)", x="Catch Percentage within a game for varying Targets>(1,3,5,7)", y="Fantasy Points within a game")
```

# Data Prediction

```{r echo=FALSE}
ggplot(big_association, aes(x=factor(recTarg), y=fantasyPts.y)) +
  geom_boxplot(fill="darkorchid4") +
  labs(title="Year-End Points by Receiving Targets within a single game (TE)", x="Targets within game", y="Year-End Fantasy Points")

ggplot(big_association, aes(x=factor(recRec), y=fantasyPts.y)) +
  geom_boxplot(fill="darkorchid4") +
  labs(title="Year-End Points by Receptions within a single game (TE)", x="Receptions within game", y="Year-End Fantasy Points")

ggplot(big_association, aes(x=factor(rzRecTarg), y=fantasyPts.y)) +
  geom_boxplot(fill="darkorchid4") +
  labs(title="Year-End Points by Redzone Receiving Targets within a single game (TE)", x="Redzone Targets within game", y="Year-End Fantasy Points")

ggplot(big_association, aes(x=factor(rzRecRec), y=fantasyPts.y)) +
  geom_boxplot(fill="darkorchid4") +
  labs(title="Year-End Points by Redzone Receptions within a single game (TE)", x="Redzone Recpetions within game", y="Year-End Fantasy Points")
```

```{r echo=FALSE}
ggplot(big_association, aes(x=fantasyPts.x, y=fantasyPts.y, alpha=.33)) +
  geom_point() +
  scale_size(range=c(1,3)) +
  geom_smooth(method="loess") +
  labs(title="Year-End Points by Fantasy Points within a game (TE)", x="Fantasy Points within a game", y="Year-End Fantasy Points")

ggplot(big_association, aes(fantasyPts.x, fill="darkorchid4")) +
  geom_histogram() +
  geom_vline(xintercept=7.5, linetype="dashed", color="black", linewidth=1.25) +
  labs(title="Fantasy Points within a Game Distribution (TE)", x="Fantasy Points within a game", y="", fill="")
```

```{r echo=FALSE}
ggplot(big_pairs, aes(x=fantasyPts.x, y=fantasyPts.y, alpha=.33)) +
  geom_point() +
  scale_size(range=c(1,3)) +
  geom_smooth(method="loess") +
  labs(title="Year-End Points by Fantasy Points within Consecutive Games (TE)", x="Average Fantasy Points within consecutive games", y="Year-End Fantasy Points")

ggplot(big_pairs, aes(fantasyPts.x, fill="darkorchid4")) +
  geom_histogram() +
  geom_vline(xintercept=7.5, linetype="dashed", color="black", linewidth=1.25) +
  labs(title="Fantasy Points within Consecutive Games Distribution (TE)", x="Average Fantasy Points within consecutive games", y="", fill="")
```

```{r echo=FALSE}
ggplot(big_trios, aes(x=fantasyPts.x, y=fantasyPts.y, alpha=.33)) +
  geom_point() +
  scale_size(range=c(1,3)) +
  geom_smooth(method="loess") +
  labs(title="Year-End Points by Fantasy Points within a Triplet of Games (TE)", x="Average Fantasy Points within a Triplet of games", y="Year-End Fantasy Points")

ggplot(big_trios, aes(fantasyPts.x, fill="darkorchid4")) +
  geom_histogram() +
  geom_vline(xintercept=7.5, linetype="dashed", color="black", linewidth=1.25) +
  labs(title="Fantasy Points within Triplet of Games Distribution (TE)", x="Average Fantasy Points within a Triplet of games", y="", fill="")
```

```{r echo=FALSE}
ggplot(big_half, aes(x=fantasyPts.x, y=fantasyPts.y, alpha=.33)) +
  geom_point() +
  scale_size(range=c(1,3)) +
  geom_smooth(method="loess") +
  labs(title="Year-End Points by Fantasy Points in First Half of Games (TE)", x="Average Fantasy Points in First Half of games", y="Year-End Fantasy Points")

ggplot(big_half, aes(fantasyPts.x, fill="darkorchid4")) +
  geom_histogram() +
  geom_vline(xintercept=7.5, linetype="dashed", color="black", linewidth=1.25) +
  labs(title="Fantasy Points in First Half of Games Distribution (TE)", x="Average Fantasy Points in First Half of games", y="", fill="")
```

```{r echo=FALSE}
data <- big_association %>% 
  select(-c(fantasyPts.x)) %>% 
  na.omit()
all <- lm(fantasyPts.y ~ ., data=data)
model <- step(all, direction = "backward", trace=0)
summary(model)
```

```{r echo=FALSE}
data <- big_association %>% 
  select(c(recRec, recYds, recTds, fantasyPts.y)) %>% 
  na.omit()
all <- lm(fantasyPts.y ~ ., data=data)
model <- step(all, direction = "backward", trace=0)
summary(model)
```

```{r echo=FALSE}
data <- big_pairs %>% 
  select(-c(fantasyPts.x)) %>% 
  na.omit()
all <- lm(fantasyPts.y ~ ., data=data)
model <- step(all, direction = "backward", trace=0)
summary(model)
```

```{r echo=FALSE}
data <- big_pairs %>% 
  select(c(recRec, recYds, recTds, fantasyPts.y)) %>% 
  na.omit()
all <- lm(fantasyPts.y ~ ., data=data)
model <- step(all, direction = "backward", trace=0)
summary(model)
```

```{r echo=FALSE}
data <- big_trios %>% 
  select(c(recRec, recYds, recTds, fantasyPts.y)) %>% 
  na.omit()
all <- lm(fantasyPts.y ~ ., data=data)
model <- step(all, direction = "backward", trace=0)
summary(model)
```

```{r echo=FALSE}
ggplot(big_pairs, aes(x=recTarg, y=fantasyPts.y)) +
  geom_smooth(data=subset(big_pairs, recTds<.5), method="loess", se=F, color="darkorchid2", linewidth=1.25) +
  geom_smooth(data=subset(big_pairs, recTds>.5), method="loess", se=F, color="darkorchid4", linewidth=1.25) +
  labs(title="Year-End Points by Receiving Targets consecutive games (TE)", x="Avg Targets in consecutive games (0.5<)TDs(>0.5)", y="Year-End Fantasy Points")

ggplot(big_pairs, aes(x=recRec, y=fantasyPts.y)) +
  geom_smooth(data=subset(big_pairs, recTds<.5), method="loess", se=F, color="darkorchid2", linewidth=1.25) +
  geom_smooth(data=subset(big_pairs, recTds>.5), method="loess", se=F, color="darkorchid4", linewidth=1.25) +
  labs(title="Year-End Points by Receptions consecutive games (TE)", x="Avg Receptions in consecutive games (0.5<)TDs(>0.5)", y="Year-End Fantasy Points")
```

```{r echo=FALSE}
ggplot(subset(big_pairs, recTds<2), aes(x=factor(recTds), y=fantasyPts.y)) +
  geom_violin(fill="darkorchid4", width=1) +
  labs(title="Receiving Tds and Fantasy Points in consecutive games (TE)", x="Avg Receiving Touchdowns in consecutive games", y="Year-End Fantsy Points")

ggplot(subset(big_pairs, recTds<2), aes(x=factor(recTds), y=fantasyPts.y)) +
  geom_violin(fill="darkorchid4", scale="count", width=2) +
  labs(title="Receiving Tds and Fantasy Points in consecutive games (TE)", x="Avg Receiving Touchdowns in consecutive games", y="Year-End Fantsy Points")
```

